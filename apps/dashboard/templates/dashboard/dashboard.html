{% extends 'base.html' %}

{% block title %}Dashboard{% endblock %}

{{ financials|json_script:"financials-data" }}

{% block content %}
<div class="dashboard-grid">
    <!-- Stat Cards -->
    <div class="card stat-card">
        <h3>Crop Summary üåΩ</h3>
        <p>{{ total_crops }} types of crops</p>
    </div>
    <div class="card stat-card">
        <h3>Livestock Count üêÑ</h3>
        <p>{{ total_livestock }} animals</p>
    </div>
    <div class="card stat-card">
        <h3>Finance Overview üí∞</h3>
        <p>Net Profit: ${{ net_profit|floatformat:2 }}</p>
    </div>
    <div class="card stat-card">
        <h3>Weather Snapshot üå¶</h3>
        {% if latest_weather %}
            <p>{{ latest_weather.description }}</p>
            <p>{{ latest_weather.temperature }}&deg;C, {{ latest_weather.humidity }}% humidity</p>
        {% else %}
            <p>No weather data available</p>
        {% endif %}
    </div>

    <!-- Navigation Cards -->
    <a href="{% url 'crop_list' %}" class="card nav-card">Crops</a>
    <a href="{% url 'livestock_list' %}" class="card nav-card">Livestock</a>
    <a href="{% url 'worker_list' %}" class="card nav-card">Workers</a>
    <a href="{% url 'inventory_item_list' %}" class="card nav-card">Inventory</a>
    <a href="{% url 'finance_list' %}" class="card nav-card">Finance</a>
    <a href="{% url 'reports_list' %}" class="card nav-card">Reports</a>
    <a href="{% url 'yield_list' %}" class="card nav-card">Yield</a>
    <a href="{% url 'weather_list' %}" class="card nav-card">Weather</a>
    <a href="{% url 'timelogs_list' %}" class="card nav-card">Timelogs</a>
</div>

<div class="chart-container mt-4 card">
    <h3 class="text-center">Financial Summary</h3>
    <canvas id="financeChart"></canvas>
</div>

<style>
.dashboard-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
}

.card {
    background-color: #f8f9fa;
    padding: 20px;
    border-radius: 8px;
    text-align: center;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.stat-card h3 {
    margin-bottom: 10px;
}

.nav-card {
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 20px;
    color: #333;
    text-decoration: none;
    transition: transform 0.2s;
}

.nav-card:hover {
    transform: translateY(-5px);
    background-color: #e9ecef;
}
</style>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const financialsData = JSON.parse(document.getElementById('financials-data').textContent);
    const ctx = document.getElementById('financeChart').getContext('2d');
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['Income', 'Expenses', 'Net Profit'],
            datasets: [{
                label: 'Amount in USD',
                data: [financialsData.income, financialsData.expenses, financialsData.net_profit],
                backgroundColor: [
                    'rgba(46, 125, 50, 0.7)',
                    'rgba(183, 28, 28, 0.7)',
                    'rgba(212, 160, 23, 0.7)'
                ],
                borderColor: [
                    'rgba(46, 125, 50, 1)',
                    'rgba(183, 28, 28, 1)',
                    'rgba(212, 160, 23, 1)'
                ],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        callback: function(value, index, values) {
                            return '$' + value;
                        }
                    }
                }
            }
        }
    });
</script>
{% endblock %}
